
/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.0/userguide/java_library_plugin.html
 */
 
 apply plugin: 'ear'
// apply plugin: 'java'


/* plugins {
    // Apply the java-library plugin to add support for Java Library
    id 'java-library'
    id 'ear'
} */

// version
project.version = ''

repositories {
    // Use jcenter for resolving dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
    // mavenCentral()
}

archivesBaseName="northwindEAR"

dependencies {
	deploy project(path: ':northwind', configuration: 'archives')	
    // This dependency is exported to consumers, that is to say found on their compile classpath.
    // api 'org.apache.commons:commons-math3:3.6.1'

    // This dependency is used internally, and not exposed to consumers on their own compile classpath.
    // implementation 'com.google.guava:guava:28.0-jre'

    // Use JUnit test framework
    // testImplementation 'junit:junit:4.12'
}

task deployLocal(type: Copy) {
	from 'build/libs/northwindEAR.ear'
	into '/Users/larryricker/wildfly-18.0.1.Final/standalone/deployments/'
}

task renameEar (type: Copy) {
	dependsOn assemble
	println "EAR NAME : northwindEAR-${project.version}.ear"
	from 'build/libs/'
	rename ("northwindEAR-${project.version}.ear", "northwindEAR.ear")
	
}

task cleanEar(type: Delete) {
	dependsOn renameEar
	delete ("build/libs/northwindEAR.ear")
}

task buildEar() {
	dependsOn cleanEar
}

task copyBindingFile(type: Copy) {
	from('bindings') {
		include 'permissions.xml'
	} into 'EarContent/META-INF'
}

ear {
	println "ear"
	appDirName 'EarContent'
	dependsOn copyBindingFile
	// deploymentDescriptor { webModule("northwindWeb.war", "northwindWeb")}
	println new Date() 
}

ear.doLast {
	File file = new File("${rootDir}${File.separator}..${File.separator}northwindEAR${File.separator}build${File.separator}libs${File.separator}northwindEAR.ear")
	println "EAR ${file.toString()} has ${file.length()} bytes\r\n${file.length()/1000000} MB"
}
